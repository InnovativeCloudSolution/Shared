---
globs: **MIT-Azure Automation/**
alwaysApply: false
---

## Global Integration Points
- Azure Key Vault: `mit-azu1-prod1-akv1`
- ConnectWise PSA: `https://au.myconnectwise.net/v4_6_release/apis/3.0`
- Microsoft Graph: `https://graph.microsoft.com/v1.0` and `/beta`

## Commit Message Guidelines
- First line < 50 chars; imperative mood
- Sections: Type (Update|Fix|New|Refactor|Remove), Script, Scope, Details, Lines Modified
- Prefixes: `[AZ] [AAD] [EXO] [SPO] [TEAMS] [INTUNE] [M365] [CWPSA] [UTIL] [CONFIG] [DOCS]`

Template:
```
[Script Type] Brief description of changes

Type: (Update | Fix | New | Refactor | Remove)

Script: Script Name (without prefix and extension)

Scope: Specific function/method/section changed

Details: What was changed and why

Lines Modified: Which sections/line numbers affected
```

# MIT-Azure Automation (Runbooks)

### Auto-Deployment
- Files under `/REPORTING-AZU1-PROD1-AA/` deploy automatically on commit; test locally first.

### Function Library Structure (dot-source as needed)
```
. .\Function-ALL-General.ps1         # Write-MessageLog, Write-ErrorLog
. .\Function-ALL-MSGraph.ps1         # MS Graph integrations
. .\Function-ALL-MSGraph-Intune.ps1  # Intune operations
. .\Function-ALL-CWM.ps1             # ConnectWise Manage
. .\Function-ALL-3CX.ps1             # 3CX integrations
```

### Standard Runbook Pattern
```
function ProcessMainFunction {
    try {
        Write-MessageLog "Starting process..." -Level "INFO"
        # Main logic here
        Write-MessageLog "Process completed successfully" -Level "INFO"
    } catch {
        Write-ErrorLog -Message "Error: $_"
    }
}
ProcessMainFunction
```

### Quality & Practices
- Keep runbooks idempotent and safe to re-run.
- Prefer centralized library functions over duplication.
- Use `Write-MessageLog` for logging, `Write-ErrorLog` for errors.

### Security
- Use Key Vault `mit-azu1-prod1-akv1` (same secret naming as above).
- Never commit credentials.